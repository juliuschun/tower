# Claude Desk â€” ë¦¬ì„œì¹˜/ë¶„ì„ íŒ€ì„ ìœ„í•œ Claude Code ì›¹ í”Œë«í¼

## Context

ì›ê²© ì„œë²„(Azure VM)ì—ì„œ Claude Codeë¥¼ ëŒë¦¬ê³  ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†í•˜ëŠ” í™˜ê²½ì„ êµ¬ì¶• ì¤‘.
ê¸°ì¡´ ì˜¤í”ˆì†ŒìŠ¤ 3ê°œ(claude-code-webui, claude-code-web, claude-code-ui)ë¥¼ ë¶„ì„í•œ ê²°ê³¼,
SDK ê¸°ë°˜ + ê¹”ë”í•œ UI + íŒŒì¼/ì—ë””í„°ë¥¼ ê²°í•©í•œ ìì²´ í”Œë«í¼ì´ í•„ìš”.

**íƒ€ê²Ÿ ìœ ì €:** ë¦¬ì„œì¹˜/ë¶„ì„ íŒ€ (ë¹„ê°œë°œì í¬í•¨)
**í•µì‹¬ ë‹ˆì¦ˆ:** Claudeì™€ ëŒ€í™”í•˜ë©° ë¦¬ì„œì¹˜ â†’ MD ë³´ê³ ì„œ ë Œë”ë§ â†’ íŒŒì¼ í¸ì§‘

**ë¹„-ëª©í‘œ (Non-goals):**
- ë©€í‹° ì„œë²„ í´ëŸ¬ìŠ¤í„°ë§ / ìˆ˜í‰ ìŠ¤ì¼€ì¼ë§ (ë‹¨ì¼ VM ì „ì œ)
- ì‹¤ì‹œê°„ í˜‘ì—… (ë™ì‹œ í¸ì§‘, ì»¤ì„œ ê³µìœ  ë“±)
- Claude API ì§ì ‘ í˜¸ì¶œë¡œ SDK ìš°íšŒ

---

## Tech Stack

| ë ˆì´ì–´ | ì„ íƒ | ì´ìœ  |
|--------|------|------|
| **Frontend** | React 18 + Vite + TailwindCSS v4 | ì„¸ ì˜¤í”ˆì†ŒìŠ¤ ëª¨ë‘ ì‚¬ìš©. ê²€ì¦ë¨ |
| **Backend** | Express + WebSocket (ws) | HTTP + ì–‘ë°©í–¥ ì‹¤ì‹œê°„ í†µì‹  |
| **Claude ì—°ë™** | @anthropic-ai/claude-code SDK | PTY ì•„ë‹Œ SDK. API í‚¤ ì „í™˜ ìš©ì´ |
| **ì—ë””í„°** | CodeMirror 6 (@uiw/react-codemirror) | Monacoë³´ë‹¤ ê°€ë³ê³  ëª¨ë°”ì¼ ì§€ì› |
| **MD ë Œë”ë§** | react-markdown + remark-gfm + rehype-highlight | GFM í…Œì´ë¸”, ì½”ë“œ í•˜ì´ë¼ì´íŒ… |
| **DB** | better-sqlite3 | ì„¸ì…˜ ë©”íƒ€, ìœ ì €, ìŠ¤í¬ë¦½íŠ¸ ì €ì¥ |
| **ìƒíƒœê´€ë¦¬** | zustand | Reduxë³´ë‹¤ ë‹¨ìˆœ |
| **ì–¸ì–´** | TypeScript | í”„ë¡ íŠ¸/ë°±ì—”ë“œ ëª¨ë‘ |

---

## UI ë ˆì´ì•„ì›ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HEADER: ë¡œê³  Â· ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„ íƒ Â· ì„¸ì…˜ ì´ë¦„ Â· ì„¤ì •  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        â”‚                         â”‚                   â”‚
â”‚ LEFT   â”‚    CENTER               â”‚   RIGHT           â”‚
â”‚ SIDEBARâ”‚    CHAT PANEL           â”‚   CONTEXT PANEL   â”‚
â”‚        â”‚                         â”‚                   â”‚
â”‚ ì„¸ì…˜   â”‚  [ë©”ì‹œì§€ ë²„ë¸”]           â”‚  MD ë Œë” ë·°ì–´     â”‚
â”‚ íˆìŠ¤í† ë¦¬â”‚  [ë„êµ¬ ì‚¬ìš© ì¹´ë“œ]        â”‚  ì½”ë“œ ì—ë””í„°      â”‚
â”‚        â”‚  [ì‚¬ê³  ê³¼ì • ì ‘ê¸°]        â”‚                   â”‚
â”‚ í”„ë¡¬í”„íŠ¸â”‚                         â”‚  HTML iframe      â”‚
â”‚        â”‚                         â”‚  íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°     â”‚
â”‚ íŒŒì¼   â”‚                         â”‚  í”„ë¡¬í”„íŠ¸ ë¯¸ë¦¬ë³´ê¸° â”‚
â”‚ íŠ¸ë¦¬   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                   â”‚
â”‚        â”‚  â”‚ ì…ë ¥ì°½ + / ëª…ë ¹ì–´  â”‚  â”‚                   â”‚
â”‚ í•€ë³´ë“œ  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  BOTTOM BAR: ë¹„ìš© Â· í† í° ì‚¬ìš©ëŸ‰ Â· ì„¸ì…˜ ìƒíƒœ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **ì¢Œì¸¡ ì‚¬ì´ë“œë°”:** ì ‘ê¸° ê°€ëŠ¥. ì„¸ì…˜ íˆìŠ¤í† ë¦¬ (í•˜ë‹¨ì— í”„ë¡¬í”„íŠ¸ ì„¹ì…˜) + íŒŒì¼ íŠ¸ë¦¬ + í•€ë³´ë“œ
- **ì¤‘ì•™ ì±„íŒ…:** ë©”ì¸ ì¸í„°ë™ì…˜. Claude ì‘ë‹µì€ ë§ˆí¬ë‹¤ìš´ ë Œë”ë§
- **ìš°ì¸¡ ì»¨í…ìŠ¤íŠ¸:** íŒŒì¼ í´ë¦­ ì‹œ ì—´ë¦¼. MD ë Œë”/ì—ë””í„°/HTML iframe. ë“œë˜ê·¸ ë¦¬ì‚¬ì´ì¦ˆ + ì—´ê¸°/ë‹«ê¸° í† ê¸€ (ë„ˆë¹„ localStorage ì €ì¥)
- **ëª¨ë°”ì¼ (â‰¤768px):** í•˜ë‹¨ íƒ­ë°”ë¡œ ì „í™˜ (ğŸ’¬ì±„íŒ… | ğŸ“íŒŒì¼ | âœï¸í¸ì§‘ | ğŸ“Œí•€). íŒŒì¼ í´ë¦­ ì‹œ í¸ì§‘ íƒ­ ìë™ ì „í™˜. ë“œë˜ê·¸&ë“œë¡­ ëŒ€ì‹  ë¡±í”„ë ˆìŠ¤â†’"ì±„íŒ…ì— ì²¨ë¶€"

### ë¹„ê°œë°œìë¥¼ ìœ„í•œ UI ì›ì¹™

- Git ìš©ì–´ ì—†ìŒ: "commit" â†’ "ìŠ¤ëƒ…ìƒ· ì €ì¥", "branch" â†’ "ë²„ì „"
- íŒŒì¼ ê²½ë¡œ ëŒ€ì‹  ë¹µí¬ëŸ¼ ë„¤ë¹„ê²Œì´ì…˜
- ë„êµ¬ ì‚¬ìš© ì¹´ë“œ: "ëª…ë ¹ì–´ ì‹¤í–‰ë¨: íŒ¨í‚¤ì§€ 3ê°œ ì„¤ì¹˜" (ì ‘ìœ¼ë©´ ìƒì„¸)
- ì—ëŸ¬: ìš”ì•½ ë¨¼ì €, "ê¸°ìˆ  ìƒì„¸" ì ‘ê¸°
- MD íŒŒì¼ì€ ë Œë”ë§ ë·°ê°€ ê¸°ë³¸, "í¸ì§‘" í† ê¸€ë¡œ ì—ë””í„° ì „í™˜

---

## í•µì‹¬ ì•„í‚¤í…ì²˜

### 1. SDK ì—°ë™ (backend/services/claude-sdk.ts)

```
ë¸Œë¼ìš°ì € â†WebSocketâ†’ Express ì„œë²„ â†SDK query()â†’ Claude CLI ë°”ì´ë„ˆë¦¬
```

- `@anthropic-ai/claude-code` SDKì˜ `query()` ë¹„ë™ê¸° ì œë„ˆë ˆì´í„° ì‚¬ìš©
- `pathToClaudeCodeExecutable: "/home/azureuser/.local/bin/claude"`
- `permissionMode: "bypassPermissions"` (--dangerously-skip-permissions ëŒ€ì‘)
- `resume: sessionId` ë¡œ ì„¸ì…˜ ì´ì–´í•˜ê¸°
- **CLAUDECODE í™˜ê²½ë³€ìˆ˜ ì œê±° í•„ìˆ˜** â€” `delete process.env.CLAUDECODE` at startup

### 2. WebSocket í”„ë¡œí† ì½œ

```
CLIENT â†’ SERVER:
  chat        { message, sessionId, cwd }
  abort       { sessionId }
  file_read   { path }
  file_write  { path, content }
  file_tree   { path }
SERVER â†’ CLIENT:
  sdk_message { data: SDKMessage }
  sdk_done    { sessionId, cost, duration }
  file_content { path, content, language }
  file_tree    { entries }
  file_changed { path, changeType }
  error         { message }
```

### 3. SDK ë©”ì‹œì§€ â†’ UI ë§¤í•‘

| SDK ë©”ì‹œì§€ íƒ€ì… | UI ë Œë”ë§ |
|----------------|-----------|
| `system` (subtype: init) | ì„¸ì…˜ ì´ˆê¸°í™”, ì‚¬ìš© ê°€ëŠ¥í•œ slash_commands ëª©ë¡ íŒŒì‹± |
| `assistant` â†’ content `text` | ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ëœ ë©”ì‹œì§€ ë²„ë¸” |
| `assistant` â†’ content `tool_use` | ë„êµ¬ ì‚¬ìš© ì¹´ë“œ (Bashâ†’ëª…ë ¹+ì¶œë ¥, Readâ†’íŒŒì¼ë¯¸ë¦¬ë³´ê¸°, Write/Editâ†’diff) |
| `assistant` â†’ content `thinking` | ì ‘ê¸° ê°€ëŠ¥í•œ "ì‚¬ê³  ê³¼ì •" ë¸”ë¡ |
| `result` | ë¹„ìš© ë°°ì§€ ì—…ë°ì´íŠ¸, ì„¸ì…˜ í†µê³„ |

### 4. íŒŒì¼ ì‹œìŠ¤í…œ

- Express REST APIë¡œ íŒŒì¼ íŠ¸ë¦¬ / ì½ê¸° / ì“°ê¸°
- `chokidar`ë¡œ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ê°ì‹œ â†’ ë³€ê²½ ì‹œ WebSocket push
- ê²½ë¡œ ê²€ì¦: ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë°– ì ‘ê·¼ ì°¨ë‹¨
- `.git/`, `node_modules/`, `__pycache__/` ê¸°ë³¸ ìˆ¨ê¹€

### 5. ìŠ¬ë˜ì‹œ ëª…ë ¹ì–´ & Skills

- `~/.claude/commands/` ì™€ `~/.claude/skills/` ìŠ¤ìº”í•˜ì—¬ ëª…ë ¹ì–´ ëª©ë¡ ìƒì„±
- `/` ì…ë ¥ ì‹œ ë“œë¡­ë‹¤ìš´ í”¼ì»¤ í‘œì‹œ (ì´ë¦„ + ì„¤ëª…)
- SDKê°€ slash commandsë¥¼ ë„¤ì´í‹°ë¸Œ ì²˜ë¦¬ â€” `/` ë–¼ê³  promptë¡œ ì „ë‹¬

### 7. ì„¸ì…˜ ê´€ë¦¬

- **Claude ë„¤ì´í‹°ë¸Œ ì„¸ì…˜:** `~/.claude/projects/<encoded-path>/*.jsonl` (ì½ê¸° ì „ìš©)
- **í”Œë«í¼ ë©”íƒ€ë°ì´í„°:** SQLite (ì„¸ì…˜ ì´ë¦„, íƒœê·¸, ì¦ê²¨ì°¾ê¸°, ìœ ì €)
- ì„¸ì…˜ íˆìŠ¤í† ë¦¬ ëª©ë¡ + ê²€ìƒ‰ + ì´ì–´í•˜ê¸° + ë¦¬í”Œë ˆì´

### 8. ì¸ì¦

- ì²« ì‹¤í–‰: ê´€ë¦¬ì ê³„ì • ìƒì„±
- bcrypt + JWT (24ì‹œê°„ ë§Œë£Œ)
- ì—­í• : admin / user
- `--no-auth` í”Œë˜ê·¸ë¡œ ë‹¨ë… ì‚¬ìš© ì‹œ ì¸ì¦ ë„ê¸°

### 9. ë™ì‹œì„± ëª¨ë¸

ë‹¤ì¤‘ ì‚¬ìš©ìê°€ ë™ì‹œì— Claudeì™€ ëŒ€í™”í•  ë•Œì˜ ì •ì±….

- **SDK í˜¸ì¶œ ë°©ì‹:** `query()` í˜¸ì¶œ ì‹œ ë³„ë„ ìì‹ í”„ë¡œì„¸ìŠ¤ ìƒì„± â†’ ë™ì‹œ ì„¸ì…˜ ê°€ëŠ¥í•˜ë‚˜ ë¦¬ì†ŒìŠ¤ ì œí•œ í•„ìš”
- **ë™ì‹œ ì„¸ì…˜ ìƒí•œ:** í™˜ê²½ë³€ìˆ˜ `MAX_CONCURRENT_SESSIONS` (ê¸°ë³¸ 3)
- **ì´ˆê³¼ ì‹œ ë™ì‘:** íì‰ + "í˜„ì¬ Nëª…ì´ ì‚¬ìš© ì¤‘, ì ì‹œ í›„ ì‹œë„í•˜ì„¸ìš”" UI ë©”ì‹œì§€
- **í”„ë¡œì„¸ìŠ¤ íƒ€ì„ì•„ì›ƒ:** ë‹¨ì¼ queryê°€ 5ë¶„ ì´ìƒ ì‘ë‹µ ì—†ìœ¼ë©´ abort
- **ë¦¬ì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§:** í™œì„± ì„¸ì…˜ ìˆ˜ + ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ BOTTOM BARì— í‘œì‹œ (adminë§Œ)

### 10. ê¶Œí•œ ì •ì±… (permissionMode ì „ëµ)

`bypassPermissions`ë¥¼ ì™¸ë¶€ì— ê·¸ëŒ€ë¡œ ë…¸ì¶œí•˜ë©´ ìœ„í—˜. ì—­í• ë³„ ë¶„ë¦¬:

| ì—­í•  | permissionMode | ê·¼ê±° |
|------|---------------|------|
| admin | `bypassPermissions` | ì„œë²„ ê´€ë¦¬ì, ì „ì²´ ì œì–´ |
| user | `acceptEdits` | íŒŒì¼ í¸ì§‘ì€ í—ˆìš©, ì„ì˜ ëª…ë ¹ ì‹¤í–‰ì€ ì°¨ë‹¨ |

- ì—­í•  â†’ permissionMode ë§¤í•‘ì€ `config.ts`ì—ì„œ ê´€ë¦¬
- Phase 5 ì™¸ë¶€ ë…¸ì¶œ ì „ì— ë°˜ë“œì‹œ ì ìš©
- ì¥ê¸°: ìœ ì €ë³„ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë””ë ‰í† ë¦¬ ê²©ë¦¬ (`/workspace/{username}/`) ê²€í† 

### 11. ì—ëŸ¬ ë³µêµ¬ & ì•ˆì •ì„±

Phaseë³„ë¡œ í©ì–´ì§€ì§€ ì•Šê³  ê³µí†µ ì¸í”„ë¼ë¡œ ê´€ë¦¬í•  í•­ëª©:

- **WebSocket ì¬ì—°ê²°:** í´ë¼ì´ì–¸íŠ¸ ìë™ ì¬ì—°ê²° (exponential backoff, ìµœëŒ€ 30ì´ˆ)
- **SDK í”„ë¡œì„¸ìŠ¤ hang ê°ì§€:** heartbeat ì—†ì´ Nì´ˆ ê²½ê³¼ ì‹œ abort + ìœ ì € ì•Œë¦¼
- **SQLite WAL ë¹„ëŒ€í™”:** ì£¼ê¸°ì  `PRAGMA wal_checkpoint(TRUNCATE)` ë˜ëŠ” ì•± ì‹œì‘ ì‹œ ì‹¤í–‰
- **ë°ì´í„° ìˆ˜ëª… ê´€ë¦¬:** 90ì¼ ì´ìƒ ëœ ì„¸ì…˜ JSONL ìë™ ì •ë¦¬ (ì„¤ì • ê°€ëŠ¥), DB vacuum ì£¼ê¸°

---

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
claude-desk/
  package.json
  tsconfig.json
  vite.config.ts

  backend/
    index.ts                 -- Express + WS ì„œë²„ ì—”íŠ¸ë¦¬
    config.ts                -- ì„¤ì • (í¬íŠ¸, ê²½ë¡œ, ì¸ì¦)
    db/
      schema.ts              -- SQLite ìŠ¤í‚¤ë§ˆ
    services/
      claude-sdk.ts          -- SDK query() ë˜í¼
      file-system.ts         -- íŒŒì¼ íŠ¸ë¦¬, ì½ê¸°/ì“°ê¸°, chokidar
      pin-manager.ts         -- í•€ CRUD
      session-manager.ts     -- ì„¸ì…˜ CRUD, JSONL íŒŒì‹±
      command-loader.ts      -- Skills ë¡œë”
      auth.ts                -- JWT + bcrypt
    routes/
      api.ts                 -- REST ì—”ë“œí¬ì¸íŠ¸
      ws-handler.ts          -- WebSocket ë©”ì‹œì§€ ë¼ìš°íŒ…

  frontend/
    src/
      App.tsx
      main.tsx
      stores/                -- zustand ìŠ¤í† ì–´
        chat-store.ts
        file-store.ts
        pin-store.ts
        session-store.ts
      components/
        layout/              -- Header, Sidebar, MainPanel, ContextPanel
        chat/                -- ChatPanel, MessageBubble, ToolUseCard,
                                ThinkingBlock, InputBox, SlashCommandPicker
        files/               -- FileTree, MarkdownRenderer, DiffView
        editor/              -- CodeEditor
        sessions/            -- SessionList, SessionReplay
        auth/                -- LoginPage, SetupPage
      hooks/
        useWebSocket.ts
        useClaudeChat.ts
      utils/
        message-parser.ts    -- SDK ë©”ì‹œì§€ â†’ UI ì»´í¬ë„ŒíŠ¸ ë§¤í•‘
```

---

## ê°œë°œ ë‹¨ê³„

### Phase 1: Core Chat + MD ë Œë”ë§ âœ… DONE
1. í”„ë¡œì íŠ¸ ìŠ¤ì¼ˆë ˆí†¤ (Vite + React + Express + TS) âœ…
2. `claude-sdk.ts` â€” SDK query() ë˜í•‘, CLAUDECODE í™˜ê²½ë³€ìˆ˜ ì •ë¦¬ âœ…
3. WebSocket ì„œë²„ + ê¸°ë³¸ chat í”„ë¡œí† ì½œ âœ…
4. ChatPanel, MessageBubble, InputBox ì»´í¬ë„ŒíŠ¸ âœ…
5. ToolUseCard (Bash, Read, Write, Edit ë„êµ¬ë³„ ì¹´ë“œ) âœ…
6. assistant ë©”ì‹œì§€ ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ âœ…
7. ì„¸ì…˜ resume ê¸°ë³¸ êµ¬í˜„ âœ…
8. ì‹¬í”Œ í† í° ì¸ì¦ (JWT) âœ…

### Phase 2: íŒŒì¼ ì‹œìŠ¤í…œ + ì—ë””í„° + ì„¸ì…˜ UX âœ… DONE
1. CodeMirror 6 ì—ë””í„° (textarea êµì²´, 7ì–¸ì–´ ì§€ì›) âœ…
2. íŒŒì¼ íŠ¸ë¦¬ SVG ì•„ì´ì½˜ + lazy loading + ë¡œë”© ìŠ¤í”¼ë„ˆ âœ…
3. chokidar ì‹¤ì‹œê°„ íŒŒì¼ ê°ì‹œ + WS broadcast âœ…
4. ì‚¬ì´ë“œë°” íƒ­ (ì„¸ì…˜/íŒŒì¼) ì „í™˜ âœ…
5. ì„¸ì…˜ ê²€ìƒ‰, ì¦ê²¨ì°¾ê¸° í† ê¸€, ì¸ë¼ì¸ ì´ë¦„ ë³€ê²½ âœ…
6. ì„¸ì…˜ ìë™ ìƒì„± + claudeSessionId resume âœ…
7. WS ì¸ì¦ í† í° ì „ë‹¬ âœ…

### Phase 2.5: í•€ë³´ë“œ + í”„ë¡¬í”„íŠ¸ íŒ¨ë„

ë‘ ê°€ì§€ ì¦ê²¨ì°¾ê¸° ê¸°ëŠ¥. ì—­í• ì´ ë‹¤ë¥´ë¯€ë¡œ ìœ„ì¹˜ë„ ë¶„ë¦¬.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì„¸ì…˜ | íŒŒì¼ | í•€  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ê²€ìƒ‰...]        â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  â”‚       â”‚                   â”‚
â”‚ ì„¸ì…˜ A           â”‚       â”‚  ContextPanel     â”‚
â”‚ ì„¸ì…˜ B           â”‚       â”‚  (í•€ íŒŒì¼ ë Œë”ë§)  â”‚
â”‚ ì„¸ì…˜ C           â”‚       â”‚                   â”‚
â”‚                  â”‚       â”‚                   â”‚
â”‚ â–¼ í”„ë¡¬í”„íŠ¸ (3)   â”‚       â”‚                   â”‚
â”‚ âš¡ ì¼ì¼ ë¦¬ì„œì¹˜    â”‚â”€â”€ë“œë˜ê·¸â”€â”€â†’ ì±„íŒ… InputBox
â”‚ âš¡ ì½”ë“œ ë¦¬ë·°     â”‚       â”‚                   â”‚
â”‚ [+ ì¶”ê°€]         â”‚       â”‚                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Settings  v0.1.0 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**A. í•€ë³´ë“œ (ì‚¬ì´ë“œë°” 3ë²ˆì§¸ íƒ­ "í•€") â€” íŒŒì¼/ëŒ€ì‹œë³´ë“œ ì „ìš©**

í´ë¦­ â†’ ContextPanelì—ì„œ ë Œë”ë§. ë“œë˜ê·¸ â†’ ì±„íŒ…ì— íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ ì²¨ë¶€.

| íŒŒì¼ íƒ€ì… | ContextPanel ë Œë” ë°©ì‹ |
|----------|----------------------|
| `.md` | react-markdown (ë¯¸ë¦¬ë³´ê¸°/í¸ì§‘ í† ê¸€) |
| `.html` / `.htm` | iframe (`sandbox="allow-scripts"`, same-origin ì œì™¸) |
| ê¸°íƒ€ | CodeMirror (ì½ê¸° ì „ìš©) |

**B. í”„ë¡¬í”„íŠ¸ ì„¹ì…˜ (ì„¸ì…˜ íƒ­ í•˜ë‹¨, ì ‘ê¸° ê°€ëŠ¥) â€” ì±„íŒ… ì „ìš©**

í´ë¦­ â†’ ContextPanelì— í”„ë¡¬í”„íŠ¸ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ. ë“œë˜ê·¸ â†’ ì±„íŒ… InputBoxì— ì‚½ì….
`~/.claude/commands/` í•­ëª©ì€ ìë™ìœ¼ë¡œ ëª©ë¡ì— í¬í•¨.

**DB ìŠ¤í‚¤ë§ˆ:**

```sql
CREATE TABLE IF NOT EXISTS pins (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT NOT NULL,
  pin_type TEXT NOT NULL DEFAULT 'file',  -- 'file' | 'prompt'
  file_path TEXT,                          -- file: íŒŒì¼ ê²½ë¡œ
  content TEXT,                            -- prompt: í”„ë¡¬í”„íŠ¸ ë‚´ìš©
  file_type TEXT DEFAULT 'markdown',       -- file ë Œë”ë§ìš©
  sort_order INTEGER DEFAULT 0,
  user_id INTEGER,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id)
);
```

**êµ¬í˜„ í•­ëª©:**

1. DB: `pins` í…Œì´ë¸” ì¶”ê°€ (`schema.ts`) â€” file/prompt í†µí•©
2. `pin-manager.ts` â€” í•€ CRUD + `~/.claude/commands/` ìë™ ë¡œë“œ
3. REST API (`api.ts`):
   - `GET/POST /api/pins`, `PATCH/DELETE /api/pins/:id`, `POST /api/pins/reorder`
   - `GET /api/files/serve?path=...` â€” HTML iframeìš© raw íŒŒì¼ ì„œë¹™
4. `pin-store.ts` â€” zustand ìŠ¤í† ì–´
5. í•€ë³´ë“œ íƒ­: `PinList` ì»´í¬ë„ŒíŠ¸ (íŒŒì¼ í•€ ëª©ë¡)
   - í´ë¦­ â†’ ContextPanel ì—´ê¸°
   - ë“œë˜ê·¸ â†’ ì±„íŒ… ì»¨í…ìŠ¤íŠ¸ ì²¨ë¶€
   - FileTreeì—ì„œ hover ì‹œ ğŸ“Œ ì•„ì´ì½˜ìœ¼ë¡œ ì¶”ê°€
6. í”„ë¡¬í”„íŠ¸ ì„¹ì…˜: ì„¸ì…˜ íƒ­ í•˜ë‹¨ ì ‘ê¸° ê°€ëŠ¥ ì˜ì—­ + `+` ì¶”ê°€ ë²„íŠ¼
   - í´ë¦­ â†’ ContextPanelì— ë¯¸ë¦¬ë³´ê¸°
   - ë“œë˜ê·¸ â†’ ì±„íŒ… InputBoxì— ì‚½ì…
   - ìš°í´ë¦­ â†’ í¸ì§‘ / ì‚­ì œ
7. ContextPanelì— HTML iframe ë Œë”ë§ ëª¨ë“œ ì¶”ê°€
8. App.tsx ì—°ê²°: í•€/í”„ë¡¬í”„íŠ¸ ë¡œë“œ, ë“œë˜ê·¸&ë“œë¡­ í•¸ë“¤ë§

**ì„¤ê³„ ë…¸íŠ¸:**
- íŒŒì¼ í•€: ê²½ë¡œë§Œ ì €ì¥, ë””ìŠ¤í¬ì—ì„œ ì‹¤ì‹œê°„ ì½ê¸° (`readFile()` ì¬ì‚¬ìš©)
- í”„ë¡¬í”„íŠ¸ í•€: contentì— ë‚´ìš© ì§ì ‘ ì €ì¥
- `~/.claude/commands/` í•­ëª©ì€ ì„œë²„ ì‹œì‘ ì‹œ í”„ë¡¬í”„íŠ¸ ëª©ë¡ì— ìë™ í¬í•¨ (ì½ê¸° ì „ìš©)
- `file_changed` WebSocketìœ¼ë¡œ í•€ëœ íŒŒì¼ ë³€ê²½ ìë™ ê°ì§€
- `isPathSafe()` ì¬ì‚¬ìš©í•˜ì—¬ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë°– ì ‘ê·¼ ì°¨ë‹¨

### Phase 3: ë©”ì‹œì§€ ì˜ì†í™” + í•€ë³´ë“œ + ì„¤ì • + UI í´ë¦¬ì‹œ âœ… DONE
1. message-store.ts â€” ë©”ì‹œì§€ DB ì €ì¥/ë³µì› (ws-handler ì‹¤ì‹œê°„ ì €ì¥, ì„¸ì…˜ ì „í™˜ ì‹œ ë³µì›) âœ…
2. í•€ë³´ë“œ â€” pin-manager CRUD, PinList UI, ì‚¬ì´ë“œë°” í•€ íƒ­, iframe file serve âœ…
3. ì„¤ì • íŒ¨ë„ â€” SettingsPanel, settings-store, GET /config âœ…
4. UI í´ë¦¬ì‹œ â€” ErrorBoundary, toast, FileTree ê°œì„  âœ…

### Phase 3.5: ToolUseCard ì¹© ë ˆì´ì•„ì›ƒ + DB ë§ˆì´ê·¸ë ˆì´ì…˜ âœ… DONE
1. ToolChip ê°€ë¡œ ì¹© ì»´í¬ë„ŒíŠ¸ + ToolChipGroup (í´ë¦­ ì‹œ ì„¸ë¡œ í¼ì¹¨) âœ…
2. DB ë§ˆì´ê·¸ë ˆì´ì…˜ â€” messages, pins í…Œì´ë¸” ì§ì ‘ ìƒì„± âœ…

### Phase 4: ContextPanel ê°•í™” + í”„ë¡¬í”„íŠ¸ + ì•ˆì •ì„± âœ… DONE

ì‹¤ì‚¬ìš©ì—ì„œ ê°€ì¥ ì„íŒ©íŠ¸ê°€ í° ê¸°ëŠ¥ ìˆœìœ¼ë¡œ ì •ë ¬.

#### 4A. ContextPanel ë“œë˜ê·¸ ë¦¬ì‚¬ì´ì¦ˆ + ê°œì„ 
1. ì±„íŒ…â†”íŒ¨ë„ ì‚¬ì´ ë“œë˜ê·¸ í•¸ë“¤ (ë§ˆìš°ìŠ¤/í„°ì¹˜)
2. ë”ë¸”í´ë¦­ ì‹œ ê¸°ë³¸ ë„ˆë¹„ ë¦¬ì…‹, ë„ˆë¹„ localStorage ì €ì¥
3. ì—´ê¸°/ë‹«ê¸° í† ê¸€ ë²„íŠ¼
4. HTML íŒŒì¼ iframe ë Œë”ë§ ëª¨ë“œ (í•€ë³´ë“œ ì—°ë™)

#### 4B. ìŠ¬ë˜ì‹œ ëª…ë ¹ì–´ + Skills
1. SlashCommandPicker ì»´í¬ë„ŒíŠ¸ (`/` ì…ë ¥ ì‹œ ë“œë¡­ë‹¤ìš´)
2. command-loader.ts ê°œì„  â€” `~/.claude/commands/` + skills ìŠ¤ìº”
3. ëª…ë ¹ì–´ ì„ íƒ â†’ InputBoxì— ì‚½ì… â†’ ì „ì†¡

#### 4C. í”„ë¡¬í”„íŠ¸ ì„¹ì…˜ (Phase 2.5ì—ì„œ ì´ë™)
1. DB ìŠ¤í‚¤ë§ˆ í™•ì¥ â€” pins í…Œì´ë¸”ì— `pin_type` (file/prompt), `content` ì»¬ëŸ¼ ì¶”ê°€
2. ì„¸ì…˜ íƒ­ í•˜ë‹¨ ì ‘ê¸° ê°€ëŠ¥ í”„ë¡¬í”„íŠ¸ ì˜ì—­
3. `~/.claude/commands/` í•­ëª© ìë™ ëª©ë¡ í¬í•¨
4. í´ë¦­ â†’ ContextPanelì— ë¯¸ë¦¬ë³´ê¸°, ë“œë˜ê·¸ â†’ InputBoxì— ì‚½ì…

#### 4D. ì²¨ë¶€ ì¹© ì‹œìŠ¤í…œ (Attachment Chips)

InputBoxì— "textarea + ì²¨ë¶€ ì¹© ì˜ì—­" íŒ¨í„´ ë„ì…. ChatGPT/Claude.aiì™€ ë™ì¼í•œ UX.

**UI êµ¬ì¡°:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [âš¡ ì¼ì¼ ë¦¬ì„œì¹˜ âœ•] [ğŸ“„ report.md âœ•]  â”‚  â† ì²¨ë¶€ ì¹© ì˜ì—­
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...                â”‚  â† ê¸°ì¡´ textarea
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì¹© íƒ€ì…:**
| ì†ŒìŠ¤ | ë“œë˜ê·¸ ëŒ€ìƒ | ì¹© í‘œì‹œ | ì „ì†¡ ì‹œ ë™ì‘ |
|------|-----------|---------|------------|
| í”„ë¡¬í”„íŠ¸ (user) | ì‚¬ì´ë“œë°” í”„ë¡¬í”„íŠ¸ | âš¡ ì œëª© | contentë¥¼ ë©”ì‹œì§€ ì•ì— ì‚½ì… |
| í”„ë¡¬í”„íŠ¸ (commands) | ì‚¬ì´ë“œë°” í”„ë¡¬í”„íŠ¸ | âš¡ /ëª…ë ¹ì–´ | `/ëª…ë ¹ì–´`ë¡œ ì „ì†¡ |
| íŒŒì¼ (í•€/íŠ¸ë¦¬) | ì‚¬ì´ë“œë°” íŒŒì¼/í•€ | ğŸ“„ íŒŒì¼ëª… | íŒŒì¼ ê²½ë¡œë¥¼ ì»¨í…ìŠ¤íŠ¸ë¡œ ì²¨ë¶€ |
| ì´ë¯¸ì§€ (Phase 6) | OS ë“œë˜ê·¸ ì•¤ ë“œë¡­ | ğŸ–¼ íŒŒì¼ëª… | ì—…ë¡œë“œ í›„ ê²½ë¡œ ì²¨ë¶€ |

**êµ¬í˜„ í•­ëª©:**

1. **chat-store í™•ì¥** â€” `attachments: Attachment[]` ë°°ì—´ ì¶”ê°€
   ```ts
   interface Attachment {
     id: string;
     type: 'prompt' | 'command' | 'file' | 'image';
     label: string;       // ì¹©ì— í‘œì‹œí•  ì´ë¦„
     content: string;     // ì‹¤ì œ ì „ì†¡í•  ë‚´ìš© (í”„ë¡¬í”„íŠ¸ í…ìŠ¤íŠ¸ or íŒŒì¼ ê²½ë¡œ)
   }
   ```
2. **AttachmentChip ì»´í¬ë„ŒíŠ¸** â€” íƒ€ì…ë³„ ì•„ì´ì½˜ + ì´ë¦„ + âœ• ì‚­ì œ ë²„íŠ¼
3. **InputBox ìˆ˜ì •** â€” textarea ìœ„ì— ì¹© ì˜ì—­ ë Œë”ë§, ì „ì†¡ ì‹œ attachments ì¡°í•©
4. **ë“œë˜ê·¸ ì•¤ ë“œë¡­**
   - ì‚¬ì´ë“œë°” í•­ëª©ì— `draggable` + `onDragStart` (dataTransferì— íƒ€ì…/ë°ì´í„° ì„¸íŒ…)
   - InputBoxì— `onDragOver` + `onDrop` (ì¹©ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ attachmentsì— ì¶”ê°€)
   - ë“œë¡­ ì¡´ í•˜ì´ë¼ì´íŠ¸ (ë“œë˜ê·¸ ì§„ì… ì‹œ ë³´ë” ê°•ì¡°)
5. **ì „ì†¡ ë¡œì§** â€” attachmentsë¥¼ ë©”ì‹œì§€ í…ìŠ¤íŠ¸ì™€ ì¡°í•©
   - prompt: content + "\n\n" + ì‚¬ìš©ì í…ìŠ¤íŠ¸
   - command: `/ëª…ë ¹ì–´ ì‚¬ìš©ì í…ìŠ¤íŠ¸`
   - file: `[íŒŒì¼: /path/to/file]\n\nì‚¬ìš©ì í…ìŠ¤íŠ¸` (ë˜ëŠ” SDK ì»¨í…ìŠ¤íŠ¸ ë°©ì‹)

**í™•ì¥ì„±:**
- Phase 6ì—ì„œ OS íŒŒì¼ ë“œë˜ê·¸ ì•¤ ë“œë¡­, ì´ë¯¸ì§€ ì—…ë¡œë“œë„ ë™ì¼í•œ ì¹© ì‹œìŠ¤í…œìœ¼ë¡œ í†µí•©
- ë³µìˆ˜ ì²¨ë¶€ ì§€ì› (ì—¬ëŸ¬ íŒŒì¼/í”„ë¡¬í”„íŠ¸ ë™ì‹œ)
- ì¹© ìˆœì„œ ë³€ê²½ (ë“œë˜ê·¸)ì€ ì¶”í›„

#### 4E. ì±„íŒ… ë¹„ì£¼ì–¼ ê°œì„ 
1. í°íŠ¸ ì •ë¹„ â€” ë³¸ë¬¸/ì½”ë“œ/UI í°íŠ¸ ë¶„ë¦¬, ê°€ë…ì„± ì¢‹ì€ ì›¹í°íŠ¸ ì ìš© (Pretendard, JetBrains Mono ë“±)
2. ë©”ì‹œì§€ ë²„ë¸” ë ˆì´ì•„ì›ƒ ë‹¤ë“¬ê¸° â€” ì—¬ë°±, ì¤„ê°„ê²©, ìµœëŒ€ ë„ˆë¹„ ì¡°ì •
3. ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ ìŠ¤íƒ€ì¼ ê°œì„  â€” ì½”ë“œë¸”ë¡ í…Œë§ˆ, í…Œì´ë¸”/ë¦¬ìŠ¤íŠ¸ ê°„ê²©, ì¸ë¼ì¸ ì½”ë“œ ë°°ê²½ìƒ‰
4. ToolUseCard/ToolChip ì‹œê° ë‹¤ë“¬ê¸° â€” ì•„ì´ì½˜, ìƒ‰ìƒ, hover/active ìƒíƒœ
5. íƒ€ì´í¬ê·¸ë˜í”¼ ì¼ê´€ì„± â€” í—¤ë”/ë³¸ë¬¸/ìº¡ì…˜ í¬ê¸° ì²´ê³„ ì •ë¦¬

#### 4F. ì•ˆì •ì„± + ë³´ì•ˆ
1. WebSocket ìë™ ì¬ì—°ê²° (exponential backoff, ìµœëŒ€ 30ì´ˆ)
2. SDK í”„ë¡œì„¸ìŠ¤ hang ê°ì§€ + abort + ìœ ì € ì•Œë¦¼
3. ë™ì‹œ ì„¸ì…˜ ìƒí•œ (`MAX_CONCURRENT_SESSIONS`) + íì‰ UI
4. ì—­í• ë³„ permissionMode ì ìš© (adminâ†’bypass, userâ†’acceptEdits)

### Phase 4.5: ContextPanel UX + íŒŒì¼ í¸ì§‘ ì•ˆì •ì„± âœ… DONE

1. file-store.ts í™•ì¥ â€” `lastOpenedFilePath`, `originalContent`, `externalChange` ìƒíƒœ + `markSaved()`, `reloadFromDisk()`, `keepLocalEdits()` ì•¡ì…˜ âœ…
2. file_saved ë²„ê·¸ ìˆ˜ì • â€” `markSaved()` í˜¸ì¶œë¡œ modified ë¦¬ì…‹ + originalContent ê°±ì‹  âœ…
3. file_changed ì¶©ëŒ ê°ì§€ â€” ë¡œì»¬ í¸ì§‘ ì—†ìœ¼ë©´ 500ms ë””ë°”ìš´ìŠ¤ ìë™ ë¦¬ë¡œë“œ, ë¡œì»¬ í¸ì§‘ ìˆìœ¼ë©´ ì¶©ëŒ ë°°ë„ˆ âœ…
4. Ctrl+S ì €ì¥ â€” CodeMirror `Mod-s` keymap + App.tsx ê¸€ë¡œë²Œ keydown í•¸ë“¤ëŸ¬ âœ…
5. ContextPanel ì¶©ëŒ ë°°ë„ˆ â€” "ì´ íŒŒì¼ì´ ì™¸ë¶€ì—ì„œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤" + ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸° / ë‚´ í¸ì§‘ ìœ ì§€ âœ…
6. ë¯¸ì €ì¥ ê²½ê³  â€” X ë‹«ê¸° / íŒŒì¼ ì „í™˜ ì‹œ `window.confirm()` ë‹¤ì´ì–¼ë¡œê·¸ âœ…
7. íŒ¨ë„ í† ê¸€ ë²„íŠ¼ â€” ë‹«íŒ ìƒíƒœì—ì„œ ìš°ì¸¡ ì–‡ì€ â—€ ë²„íŠ¼, í´ë¦­ ì‹œ ë§ˆì§€ë§‰ íŒŒì¼ ì¬ì˜¤í”ˆ âœ…

### Phase 5: ëª¨ë¸ ì…€ë ‰í„° + ì„¸ì…˜ ì¸í…”ë¦¬ì „ìŠ¤ âœ… DONE

#### 5A. ëª¨ë¸ ì…€ë ‰í„° âœ…

Headerì˜ ëª¨ë¸ ë°°ì§€ë¥¼ í´ë¦­í•˜ë©´ ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ ëª¨ë¸ ì „í™˜ ê°€ëŠ¥.

**ë“œë¡­ë‹¤ìš´ UI:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Claude Opus 4.6      âœ“  [MAX]  â”‚
â”‚  Claude Sonnet 4.6       [MAX]  â”‚
â”‚  Claude Haiku 4.5        [API]  â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  âš™ ëª¨ë¸ ì„¤ì •...                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**êµ¬í˜„ í•­ëª©:**
1. Header ëª¨ë¸ ë°°ì§€ â†’ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ (ModelSelector ì»´í¬ë„ŒíŠ¸)
2. ì—°ê²° ìœ í˜• ë°°ì§€ í‘œì‹œ: MAX (ë³´ë¼) / API (ì´ˆë¡) â€” ì‹¤í–‰ í™˜ê²½ ìë™ ê°ì§€
3. ëª¨ë¸ ì„ íƒ ì‹œ ë‹¤ìŒ ë©”ì‹œì§€ë¶€í„° ì ìš© (ì§„í–‰ ì¤‘ ëŒ€í™” ì˜í–¥ ì—†ìŒ)
4. Settings íŒ¨ë„ì— "ëª¨ë¸ ì„¤ì •" íƒ­ ì¶”ê°€ â€” ì‚¬ìš© ê°€ëŠ¥ ëª¨ë¸ ëª©ë¡ ê´€ë¦¬, ê¸°ë³¸ ëª¨ë¸ ì§€ì •
5. DB: `sessions` í…Œì´ë¸”ì— `model_used TEXT` ì»¬ëŸ¼ ì¶”ê°€ (ì„¸ì…˜ë³„ ëª¨ë¸ ì¶”ì )
6. ìƒˆ store: `model-store.ts` â€” ì‚¬ìš© ê°€ëŠ¥ ëª¨ë¸ ëª©ë¡, ì„ íƒëœ ëª¨ë¸, ì—°ê²° ìœ í˜•

**ê¸°ìˆ  ë…¸íŠ¸:**
- SDK `query()` í˜¸ì¶œ ì‹œ ëª¨ë¸ íŒŒë¼ë¯¸í„° ì „ë‹¬ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸ í•„ìš”
- ë¶ˆê°€ëŠ¥í•˜ë©´ Claude Code ì‹¤í–‰ ì‹œ `--model` í”Œë˜ê·¸ ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ë¡œ ì „ë‹¬
- ì—°ê²° ìœ í˜•ì€ `ANTHROPIC_API_KEY` ìœ ë¬´ ë˜ëŠ” `~/.claude/credentials` ìƒíƒœë¡œ íŒë³„

#### 5B. ì„¸ì…˜ ìë™ ì´ë¦„ ìƒì„± âœ…

ì²« ëŒ€í™” ì™„ë£Œ í›„ Haiku ì—ì´ì „íŠ¸ê°€ ìë™ìœ¼ë¡œ ì„¸ì…˜ ì œëª© ìƒì„±.

**êµ¬í˜„ í•­ëª©:**
1. ë°±ì—”ë“œ: `POST /api/sessions/:id/auto-name` â€” Haiku API ì§ì ‘ í˜¸ì¶œ (SDKì™€ ë³„ê°œ)
2. íŠ¸ë¦¬ê±°: ì²« assistant ì‘ë‹µ ì™„ë£Œ í›„ ìë™ ì‹¤í–‰
3. 15ì ë‚´ì™¸ í•œê¸€ ì œëª© ìƒì„± (ì˜ˆ: "React ë¼ìš°í„° ë²„ê·¸ ìˆ˜ì •", "DB ìŠ¤í‚¤ë§ˆ ë§ˆì´ê·¸ë ˆì´ì…˜")
4. ìœ ì €ê°€ ì§ì ‘ ì´ë¦„ ë³€ê²½ ì‹œ ìë™ ì´ë¦„ ìƒì„± ë¹„í™œì„±í™” (`auto_named` í”Œë˜ê·¸)
5. DB: `sessions` í…Œì´ë¸”ì— `auto_named INTEGER DEFAULT 1` ì»¬ëŸ¼ ì¶”ê°€

#### 5C. ì„¸ì…˜ ìš”ì•½ ì¹´ë“œ âœ…

ìˆ˜ë™ íŠ¸ë¦¬ê±° ë°©ì‹ + stale íŒíŠ¸ë¡œ ìš”ì•½ ìµœì‹ ì„± ì¸ì§€.

**ìš”ì•½ ì¹´ë“œ UI:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ ì„¸ì…˜ ìš”ì•½                            ğŸ”„  âœ•   â”‚
â”‚                                                 â”‚
â”‚ React í”„ë¡œì íŠ¸ì˜ ë¼ìš°í„° ì´ìŠˆë¥¼ ë””ë²„ê¹…í•¨.           â”‚
â”‚ App.tsxì—ì„œ ì¤‘ì²© ë¼ìš°íŠ¸ êµ¬ì¡°ë¥¼ ë¦¬íŒ©í† ë§í•˜ê³          â”‚
â”‚ ì¸ì¦ ê°€ë“œ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì¶”ê°€í•¨. í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸.      â”‚
â”‚                                                 â”‚
â”‚ ğŸ’¬ 12 turns Â· ğŸ“ 4 files edited Â· â± 23ë¶„       â”‚
â”‚ âš  ìš”ì•½ ì´í›„ 8í„´ ì§„í–‰ë¨                    ğŸ”„     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**êµ¬í˜„ í•­ëª©:**
1. ë°±ì—”ë“œ: `POST /api/sessions/:id/summarize` â€” Haiku API ì§ì ‘ í˜¸ì¶œ, ì£¼ìš” ë©”ì‹œì§€ ì½ê³  5ì¤„ ìš”ì•½
2. ìš”ì•½ ìƒì„±: ì˜¤ì§ ìœ ì €ê°€ ğŸ”„ ë²„íŠ¼ í´ë¦­ ì‹œì—ë§Œ (ìë™ ì‹¤í–‰ ì•ˆ í•¨)
3. stale í‘œì‹œ: `summary_at_turn` ì €ì¥ â†’ í˜„ì¬ turn ìˆ˜ì™€ ë¹„êµ â†’ 5í„´ ì´ìƒ ì°¨ì´ ì‹œ âš  ê²½ê³ ìƒ‰
4. ìš”ì•½ ì—†ëŠ” ì„¸ì…˜: "ì•„ì§ ìš”ì•½ ì—†ìŒ â€” ğŸ”„ ìš”ì•½ ìƒì„±" ë²„íŠ¼ë§Œ í‘œì‹œ
5. ìœ„ì¹˜: ì„¸ì…˜ ì§„ì… ì‹œ ì±„íŒ… ì˜ì—­ ìƒë‹¨ ì ‘ì´ì‹ ì¹´ë“œ
6. DB: `sessions` í…Œì´ë¸”ì— `summary TEXT`, `summary_at_turn INTEGER`, `turn_count INTEGER DEFAULT 0`, `files_edited TEXT DEFAULT '[]'` ì¶”ê°€
7. `SummaryCard.tsx` ì»´í¬ë„ŒíŠ¸ â€” ì ‘ì´ì‹, ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼, stale íŒíŠ¸
8. ë©”íƒ€ ì •ë³´ í‘œì‹œ: í„´ ìˆ˜, ìˆ˜ì • íŒŒì¼ ìˆ˜, ì†Œìš” ì‹œê°„, ë¹„ìš©/í† í°, ì‚¬ìš© ëª¨ë¸

**ì‚¬ì´ë“œë°” ì„¸ì…˜ ëª©ë¡ ê°œì„ :**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â­ React ë¼ìš°í„° ë²„ê·¸ ìˆ˜ì •    â”‚
â”‚    12 turns Â· $0.42       â”‚
â”‚    2ì‹œê°„ ì „                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    DB ìŠ¤í‚¤ë§ˆ ì„¤ê³„            â”‚
â”‚    5 turns Â· $0.18        â”‚
â”‚    ì–´ì œ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## TODO / ë°±ë¡œê·¸

### Footer: í˜„ì¬ ì„¸ì…˜ CWD í‘œì‹œ

ì±„íŒ…ì´ ì–´ëŠ í´ë”ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ì§€ BottomBarì— í‘œì‹œ.

- ìœ„ì¹˜: `App.tsx` > `BottomBar` ì»´í¬ë„ŒíŠ¸ (í•˜ë‹¨ footer)
- ì†ŒìŠ¤: `useSessionStore`ì˜ `activeSession.cwd` (ì´ë¯¸ ì„¸ì…˜ ë©”íƒ€ì— í¬í•¨ë¨)
- í‘œì‹œ ë°©ì‹: í´ë” ì•„ì´ì½˜ + ê²½ë¡œ (ê¸´ ê²½ë¡œëŠ” ì•ë¶€ë¶„ truncate)
- ì„¸ì…˜ ì—†ì„ ë•Œ: ë¯¸í‘œì‹œ

---

ì‹¤ì‚¬ìš© ì¤‘ ë°œê²¬ëœ ì´ìŠˆì™€ í–¥í›„ ê°œì„  í•­ëª©.

### âœ… ì„¸ì…˜ ê²©ë¦¬ (Cross-session message leak / ì‘ë‹µ ìœ ì‹¤) â€” DONE

ì»¤ë°‹ `32ddd8d`ì—ì„œ ìˆ˜ì • ì™„ë£Œ.
- [x] A. ì„¸ì…˜ ì „í™˜ ì‹œ abort (í”„ë¡ íŠ¸ `abort()` + ë°±ì—”ë“œ `abortSession`)
- [x] B+C. `set_active_session` í•¸ë“¤ëŸ¬ + `sendToSession` ê°€ë“œ
- [x] D. í”„ë¡ íŠ¸ sessionId í•„í„° null í—ˆì  ìˆ˜ì • (3ê³³)
- [x] activeSessions ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ 5ë¶„ ìë™ ì •ë¦¬
- [x] JWT í† í° ë§Œë£Œ ì‹œ ìë™ ë¡œê·¸ì•„ì›ƒ

### ğŸ”´ ì„¸ì…˜ CWD (ì‘ì—… ë””ë ‰í† ë¦¬) ì„¤ê³„

**í˜„ì¬ ë¬¸ì œ:**
- ì„¸ì…˜ ìƒì„± ì‹œ cwdê°€ í•­ìƒ `config.defaultCwd`ë¡œ ê³ ì • (í”„ë¡ íŠ¸ê°€ cwdë¥¼ ì•ˆ ë³´ëƒ„)
- UIì—ì„œ CWDë¥¼ ë³€ê²½í•  ë°©ë²•ì´ ì „í˜€ ì—†ìŒ
- BottomBarì— ê²½ë¡œê°€ ì˜ë ¤ì„œ í‘œì‹œë˜ê³  í´ë¦­ ë¶ˆê°€
- Claudeê°€ ì‘ì—…í•˜ëŠ” í´ë” = ì„¸ì…˜ cwdì¸ë°, ì‚¬ìš©ìê°€ ì œì–´ ë¶ˆê°€

**ì„¤ê³„ ê²°ì • í•„ìš”:**

1. **ì„¸ì…˜ ìƒì„± ì‹œ CWD ì–´ë–»ê²Œ ê²°ì •?**
   - A) ì„œë²„ ê¸°ë³¸ê°’ ê³ ì • (`config.defaultCwd`) â€” í˜„ì¬ ë°©ì‹, ë‹¨ìˆœí•˜ì§€ë§Œ ìœ ì—°ì„± ì—†ìŒ
   - B) ìƒˆ ì„¸ì…˜ UIì— í´ë” ì„ íƒ í”¼ì»¤ â€” ì‚¬ì´ë“œë°” íŒŒì¼ íŠ¸ë¦¬ì—ì„œ í´ë” ì„ íƒ í›„ ì„¸ì…˜ ìƒì„±
   - C) BottomBar ë˜ëŠ” Headerì— í´ë” ì„ íƒ ë“œë¡­ë‹¤ìš´ â€” ì„¸ì…˜ ì¤‘ì—ë„ ë³€ê²½ ê°€ëŠ¥
   - D) íŒŒì¼ íŠ¸ë¦¬ì—ì„œ í´ë” ìš°í´ë¦­ â†’ "ì—¬ê¸°ì„œ ìƒˆ ì„¸ì…˜" â€” íŒŒì¼ íƒìƒ‰ê³¼ ìì—°ìŠ¤ëŸ½ê²Œ ì—°ê²°

2. **ì„¸ì…˜ ë„ì¤‘ CWD ë³€ê²½ í—ˆìš©?**
   - í—ˆìš©í•˜ë©´: ë°±ì—”ë“œì—ì„œ ë‹¤ìŒ chatë¶€í„° ìƒˆ cwd ì ìš© + DB ì—…ë°ì´íŠ¸
   - ë¹„í—ˆìš©í•˜ë©´: ì„¸ì…˜ ìƒì„± ì‹œì—ë§Œ ê²°ì •, ì´í›„ ê³ ì • (ë” ë‹¨ìˆœ)
   - Claude Code CLIëŠ” ì„¸ì…˜ ì¤‘ `cd`ë¡œ ììœ ë¡­ê²Œ ì´ë™í•˜ì§€ë§Œ, SDKì˜ cwdëŠ” ì´ˆê¸°ê°’

3. **BottomBar CWD í‘œì‹œ ê°œì„ :**
   - í´ë¦­ ì‹œ í´ë” í”¼ì»¤ ì—´ê¸° (breadcrumb ìŠ¤íƒ€ì¼ë¡œ ê²½ë¡œ í‘œì‹œ, ê° ì„¸ê·¸ë¨¼íŠ¸ í´ë¦­ ê°€ëŠ¥)
   - ë˜ëŠ” í´ë¦­ ì‹œ íŒŒì¼ íŠ¸ë¦¬ë¥¼ í•´ë‹¹ í´ë”ë¡œ ì´ë™
   - ê¸´ ê²½ë¡œ: ì•ë¶€ë¶„ ìƒëµ (`.../claude-desk`) ë˜ëŠ” `~` ìƒëŒ€ ê²½ë¡œ

**ì¶”ì²œ ë°©í–¥ (B+C ì¡°í•©):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BottomBar: ğŸŸ¢ ëŒ€ê¸° â”‚ ğŸ“ ~/tunnelingcc/claude-desk [â–¼]  â”‚
â”‚                     í´ë¦­ ì‹œ í´ë” í”¼ì»¤ ë“œë¡­ë‹¤ìš´         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
- ìƒˆ ì„¸ì…˜: ë§ˆì§€ë§‰ ì‚¬ìš© cwd ê¸°ì–µ + ë³€ê²½ ê°€ëŠ¥
- ê¸°ì¡´ ì„¸ì…˜: BottomBar í´ë¦­ìœ¼ë¡œ cwd ë³€ê²½ â†’ ë‹¤ìŒ ë©”ì‹œì§€ë¶€í„° ì ìš©
- ë³€ê²½ ì‹œ íŒŒì¼ íŠ¸ë¦¬ë„ í•´ë‹¹ í´ë”ë¡œ ê°±ì‹ 
- DBì— cwd ì—…ë°ì´íŠ¸ (`PATCH /api/sessions/:id`)

**êµ¬í˜„ ë²”ìœ„:**
- [ ] BottomBar cwd í´ë¦­ â†’ í´ë” í”¼ì»¤ ë“œë¡­ë‹¤ìš´ (íŒŒì¼ íŠ¸ë¦¬ ì¬í™œìš© ë˜ëŠ” breadcrumb)
- [ ] ì„¸ì…˜ cwd ë³€ê²½ API (`PATCH /sessions/:id` + chat ë©”ì‹œì§€ì— cwd ë°˜ì˜)
- [ ] ìƒˆ ì„¸ì…˜ ìƒì„± ì‹œ í˜„ì¬ ì„¸ì…˜ì˜ cwd ìƒì†
- [ ] `sendMessage`ì—ì„œ `activeSession.cwd`ë¥¼ chat ë©”ì‹œì§€ì— í¬í•¨

### ì„¸ì…˜ ì´ë¦„ ì¸ë¼ì¸ í¸ì§‘ (ì‚¬ì´ë“œë°”)

í˜„ì¬ ì„¸ì…˜ ì´ë¦„ ë³€ê²½ì€ ë”ë¸”í´ë¦­ â†’ inputìœ¼ë¡œ ê°€ëŠ¥í•˜ì§€ë§Œ, ë¦¬ìŠ¤íŠ¸ì—ì„œì˜ UXê°€ ë¶ˆì™„ì „.

- [ ] ì„¸ì…˜ ëª©ë¡ì—ì„œ ì´ë¦„ ìˆ˜ì • ì§„ì…ì´ ì§ê´€ì ì´ì§€ ì•ŠìŒ (ë”ë¸”í´ë¦­ ë°œê²¬ì„± ë‚®ìŒ)
- [ ] ì´ë¦„ ë³€ê²½ ì‹œ ë¦¬ìŠ¤íŠ¸ ë ˆì´ì•„ì›ƒ ê¹œë¹¡ì„ (input í¬ê¸° ì „í™˜)
- [ ] ê°œì„ ì•ˆ: ìš°í´ë¦­ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ë˜ëŠ” í˜¸ë²„ ì‹œ ì—°í•„ ì•„ì´ì½˜ í‘œì‹œ
- [ ] ì´ë¦„ ë³€ê²½ í›„ ì •ë ¬ ìˆœì„œ ì¦‰ì‹œ ë°˜ì˜

### ì„¸ì…˜ ì—°ì†ì„± / ë©”ì‹œì§€ ìœ ì‹¤ ë¬¸ì œ

ì„¸ì…˜ ì‘ì—… ì¤‘ê°„ì— ë‹¤ë¥¸ ì„¸ì…˜ìœ¼ë¡œ ì „í™˜ í›„ ëŒì•„ì™”ì„ ë•Œ, ë˜ëŠ” ì„œë²„ ì¬ì‹œì‘ì´ ë°œìƒí–ˆì„ ë•Œ ê¸°ì¡´ ì‘ì—… íë¦„ì´ ëŠê¸°ëŠ” ë¬¸ì œ.

**ì¦ìƒ:**
- thinking ì¤‘ì— ì„œë²„ê°€ ì¬ì‹œì‘ë˜ë©´ í•´ë‹¹ í„´ì˜ ì‘ë‹µì´ ìœ ì‹¤ë¨
- ì„¸ì…˜ Aì—ì„œ ì‘ì—… ì¤‘ â†’ ì„¸ì…˜ Bë¡œ ì „í™˜ â†’ ì„¸ì…˜ Aë¡œ ë³µê·€ ì‹œ, SDK ë‚´ë¶€ ìƒíƒœì™€ UI ìƒíƒœ ë¶ˆì¼ì¹˜
- ì„œë²„ ì¬ì‹œì‘ í›„ `claudeSessionId`ë¡œ resumeí•´ë„, ë§ˆì§€ë§‰ í„´ì´ ë°˜ì˜ë˜ì§€ ì•Šì€ ì±„ ì´ì–´ì§€ëŠ” ê²½ìš° ìˆìŒ

**ì¡°ì‚¬ í•„ìš” í•­ëª©:**
- [ ] SDK `resume` ì‹œ ë§ˆì§€ë§‰ ë¯¸ì™„ë£Œ í„´ì˜ ì²˜ë¦¬ ë°©ì‹ í™•ì¸ (SDKê°€ ì¬ì „ì†¡í•˜ëŠ”ì§€, ë¬´ì‹œí•˜ëŠ”ì§€)
- [ ] ì„œë²„ ì¬ì‹œì‘ ê°ì§€ â†’ í”„ë¡ íŠ¸ì— "ì„œë²„ê°€ ì¬ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ë§ˆì§€ë§‰ ì‘ë‹µì´ ìœ ì‹¤ë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤" ì•Œë¦¼
- [ ] ws reconnect ì‹œ ì„¸ì…˜ ìƒíƒœ ì¬ë™ê¸°í™” (í˜„ì¬ claudeSessionId, ë§ˆì§€ë§‰ ë©”ì‹œì§€ ID ë¹„êµ)
- [ ] ìŠ¤íŠ¸ë¦¬ë° ì¤‘ WS ëŠê¹€ â†’ ì¬ì—°ê²° í›„ ë¯¸ì™„ë£Œ ì‘ë‹µ ë³µêµ¬ ê°€ëŠ¥ì„± (SDK abort í›„ ì¬ì‹œë„?)
- [ ] DBì— ì €ì¥ëœ ë©”ì‹œì§€ì™€ ì‹¤ì œ SDK ì„¸ì…˜ ìƒíƒœì˜ ì¼ê´€ì„± ë³´ì¥ ë°©ì•ˆ

**ì ì¬ í•´ê²° ë°©í–¥:**
- ì„œë²„ ì‹œì‘ ì‹œ `boot_id` ë°œê¸‰ â†’ í”„ë¡ íŠ¸ê°€ reconnect ì‹œ ì´ì „ boot_idì™€ ë¹„êµ â†’ ë‹¤ë¥´ë©´ ì„œë²„ ì¬ì‹œì‘ ê°ì§€
- ìŠ¤íŠ¸ë¦¬ë° ì¤‘ WS ëŠê¹€ ì‹œ, ì¬ì—°ê²° í›„ ë§ˆì§€ë§‰ `sdk_done` ì´í›„ì˜ ë©”ì‹œì§€ë§Œ DBì—ì„œ ë³µì›
- ì„¸ì…˜ ì „í™˜ ì‹œ ì§„í–‰ ì¤‘ì¸ queryë¥¼ abortí•˜ê³  ìƒíƒœë¥¼ í™•ì •(committed)í•œ í›„ ì „í™˜

---

### Phase 6: ëª¨ë°”ì¼ + íŒŒì¼ ì—…ë¡œë“œ + ë°°í¬ (ì´í›„)

1. ì‚¬ì´ë“œë°” íŒŒì¼ ë“œë˜ê·¸&ë“œë¡­ â†’ ì±„íŒ… ì»¨í…ìŠ¤íŠ¸ ì²¨ë¶€
2. ë¡œì»¬ íŒŒì¼ ì—…ë¡œë“œ (OSì—ì„œ ë¸Œë¼ìš°ì €ë¡œ ë“œë˜ê·¸&ë“œë¡­)
   - **ë“œë¡­ ì¡´ 2ê³³:**
     - ì±„íŒ… ì˜ì—­ì— ë“œë¡­ â†’ íŒŒì¼ ë‚´ìš©ì„ ì»¨í…ìŠ¤íŠ¸ë¡œ ì²¨ë¶€í•˜ì—¬ Claudeì—ê²Œ ì „ë‹¬
     - íŒŒì¼ íŠ¸ë¦¬ì— ë“œë¡­ â†’ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë””ë ‰í† ë¦¬ì— ì—…ë¡œë“œ (ì €ì¥)
   - **ë°±ì—”ë“œ:** `POST /api/files/upload` (multer, multipart/form-data), `isPathSafe()` ê²€ì¦
   - **í”„ë¡ íŠ¸:** HTML5 Drag & Drop API, ë“œë¡­ ì¡´ í•˜ì´ë¼ì´íŠ¸ í‘œì‹œ, ì—…ë¡œë“œ í”„ë¡œê·¸ë ˆìŠ¤ ë°”
   - **ì œí•œ:** íŒŒì¼ í¬ê¸° ìƒí•œ (ê¸°ë³¸ 10MB, ì„¤ì • ê°€ëŠ¥), ìœ„í—˜ í™•ì¥ì ì°¨ë‹¨ (.exe, .sh ë“±)
   - **ë³µìˆ˜ íŒŒì¼:** ì—¬ëŸ¬ íŒŒì¼ ë™ì‹œ ë“œë¡­ ì§€ì›
3. ëª¨ë°”ì¼ ë°˜ì‘í˜• (í•˜ë‹¨ íƒ­ë°”, â‰¤768px)
4. ë‹¤í¬/ë¼ì´íŠ¸ í…Œë§ˆ
5. ë¹„ìš© ì¶”ì  ëŒ€ì‹œë³´ë“œ
6. Docker + Cloudflare Tunnel + PWA (ê¸°ì¡´ ë°°í¬ ê³„íš)

---

## ê²€ì¦ ë°©ë²•

1. **SDK ì—°ë™:** ì„œë²„ ì‹œì‘ â†’ ë¸Œë¼ìš°ì €ì—ì„œ "hello" ì „ì†¡ â†’ Claude ì‘ë‹µ ìŠ¤íŠ¸ë¦¬ë° í™•ì¸ âœ…
2. **ì„¸ì…˜ ì´ì–´í•˜ê¸°:** ëŒ€í™” í›„ ìƒˆë¡œê³ ì¹¨ â†’ íˆìŠ¤í† ë¦¬ì—ì„œ ì„ íƒ â†’ ì´ì „ ë§¥ë½ ìœ ì§€ í™•ì¸ âœ…
3. **íŒŒì¼ í¸ì§‘:** Claudeì—ê²Œ íŒŒì¼ ìƒì„± ìš”ì²­ â†’ íŒŒì¼ íŠ¸ë¦¬ì— ì‹¤ì‹œê°„ ë°˜ì˜ â†’ í´ë¦­í•˜ì—¬ ì—´ê¸°/í¸ì§‘
4. **MD ë Œë”ë§:** .md íŒŒì¼ ìƒì„± â†’ ë Œë”ë§ ë·°ì—ì„œ í…Œì´ë¸”/ì½”ë“œë¸”ë¡/ì´ë¯¸ì§€ í™•ì¸
5. **Skills:** `/` ì…ë ¥ â†’ ë“œë¡­ë‹¤ìš´ì— prime, ralph ë“± í‘œì‹œ â†’ ì„ íƒ ì‹œ ì‹¤í–‰ í™•ì¸ âœ…
7. **SSH í„°ë„:** `ssh -L 32354:localhost:32354 azureuser@4.230.33.35` â†’ ë¸Œë¼ìš°ì € ì ‘ì† âœ…
8. **í•€ë³´ë“œ:** í•€ íƒ­ì—ì„œ .html íŒŒì¼ í•€ â†’ í´ë¦­ ì‹œ iframe ë Œë”ë§ â†’ ë“œë˜ê·¸â†’ì±„íŒ… ì»¨í…ìŠ¤íŠ¸ ì²¨ë¶€ â†’ í•€ í•´ì œ í™•ì¸
9. **í”„ë¡¬í”„íŠ¸:** ì„¸ì…˜ íƒ­ í•˜ë‹¨ í”„ë¡¬í”„íŠ¸ ì„¹ì…˜ â†’ `+`ë¡œ ì¶”ê°€ â†’ í´ë¦­ ì‹œ ContextPanelì— ë¯¸ë¦¬ë³´ê¸° â†’ ë“œë˜ê·¸â†’ì±„íŒ… InputBox ì‚½ì… â†’ ~/.claude/commands/ í•­ëª© ìë™ í‘œì‹œ í™•ì¸

---

## Phase 6: ë°°í¬ & ì„œë¹™ â€” "ì„¤ì¹˜í•˜ë©´ ê·¸ëƒ¥ ëŒì•„ê°€ì•¼ í•œë‹¤"

### ë¬¸ì œ ì •ì˜

í˜„ì¬ ì ‘ì† ë°©ì‹: SSH í„°ë„ â†’ localhost:32354. ì´ê±´ ê°œë°œì ì „ìš©ì´ê³  ëª¨ë°”ì¼ ì ‘ì† ë¶ˆê°€.
**ëª©í‘œ:** ë¹„ê°œë°œìê°€ URL í•˜ë‚˜ë¡œ PC/ëª¨ë°”ì¼ì—ì„œ ì ‘ì†. ì„¤ì¹˜ëŠ” ëª…ë ¹ì–´ 1~2ì¤„ë¡œ ë.

---

### ë°°í¬ ì•„í‚¤í…ì²˜ (3-Tier)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ì‚¬ìš©ì ë¸Œë¼ìš°ì € (PC/ëª¨ë°”ì¼)               â”‚
â”‚                   https://desk.example.com               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ HTTPS (ìë™ ì¸ì¦ì„œ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cloudflare Tunnel        â”‚                             â”‚
â”‚  (ë¬´ë£Œ, ì•„ì›ƒë°”ìš´ë“œë§Œ)       â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Docker Compose           â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Caddy     â”‚  â”‚ claude-desk â”‚  â”‚  cloudflared   â”‚  â”‚
â”‚  â”‚ (ë¦¬ë²„ìŠ¤     â”‚â”€â”€â”‚ (Node.js    â”‚  â”‚  (í„°ë„ ë°ëª¬)    â”‚  â”‚
â”‚  â”‚  í”„ë¡ì‹œ)    â”‚  â”‚  ì•± ì„œë²„)   â”‚  â”‚                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                              â”‚
â”‚  Volumes: ~/.claude, workspace/, sqlite-data/           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Tier 1: Docker Compose (ê¸°ë³¸ ë°°í¬ ë°©ì‹)

**ì™œ Dockerì¸ê°€:**
- 1ê°œ ëª…ë ¹ìœ¼ë¡œ ì „ì²´ ìŠ¤íƒ êµ¬ë™
- OS ë¬´ê´€ (Linux, Mac, Windows)
- Claude Code CLI + Node.js + ì˜ì¡´ì„± ì „ë¶€ ì´ë¯¸ì§€ì— í¬í•¨
- ì—…ë°ì´íŠ¸: `docker compose pull && docker compose up -d`

**docker-compose.yml êµ¬ì„±:**

```yaml
services:
  app:
    image: ghcr.io/your-org/claude-desk:latest
    build: .
    ports:
      - "32354:32354"
    volumes:
      - ~/.claude:/home/app/.claude          # Claude ì¸ì¦ ì •ë³´
      - ./workspace:/workspace               # ì‘ì—… ë””ë ‰í† ë¦¬
      - sqlite-data:/app/data                # DB ì˜ì†í™”
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}  # ë˜ëŠ” ~/.claude ë§ˆìš´íŠ¸
      - AUTH_ENABLED=true
      - ADMIN_PASSWORD=${ADMIN_PASSWORD}        # ì²« ì‹¤í–‰ ì‹œ ê´€ë¦¬ì ë¹„ë²ˆ
    restart: unless-stopped

  # ì„ íƒ: ì›ê²© ì ‘ì†ì´ í•„ìš”í•  ë•Œë§Œ
  tunnel:
    image: cloudflare/cloudflared:latest
    command: tunnel run
    environment:
      - TUNNEL_TOKEN=${CF_TUNNEL_TOKEN}
    depends_on:
      - app
    restart: unless-stopped

volumes:
  sqlite-data:
```

**Dockerfile í•µì‹¬:**

```dockerfile
FROM node:20-slim

# í˜¸ìŠ¤íŠ¸ azureuserì™€ uid ì¼ì¹˜ì‹œì¼œ ~/.claude ê¶Œí•œ ë¬¸ì œ ë°©ì§€
ARG HOST_UID=1000
ARG HOST_GID=1000
RUN groupmod -g ${HOST_GID} node && usermod -u ${HOST_UID} -g ${HOST_GID} node

# Claude Code CLI ì„¤ì¹˜
RUN npm install -g @anthropic-ai/claude-code

# ì•± ë¹Œë“œ
WORKDIR /app
COPY --chown=node:node package*.json ./
RUN npm ci --production
COPY --chown=node:node dist/ ./dist/

# CLAUDECODE í™˜ê²½ë³€ìˆ˜ ì œê±° (SDK ìš”êµ¬ì‚¬í•­)
ENV CLAUDECODE=""

# non-root ì‹¤í–‰ (uidê°€ í˜¸ìŠ¤íŠ¸ì™€ ì¼ì¹˜í•˜ë¯€ë¡œ volume ê¶Œí•œ OK)
USER node
EXPOSE 32354
CMD ["node", "dist/backend/index.js"]
```

> **ì£¼ì˜:** `~/.claude` volume mount ì‹œ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ uidì™€ í˜¸ìŠ¤íŠ¸ uidê°€ ì¼ì¹˜í•´ì•¼ í•¨.
> `permission_issue.md` ì°¸ê³ . ë¹Œë“œ ì‹œ `--build-arg HOST_UID=$(id -u)` ë¡œ ì¡°ì • ê°€ëŠ¥.

**ì„¤ì¹˜ í”Œë¡œìš° (ì‚¬ìš©ì ì‹œì ):**

```bash
# 1. ë‹¤ìš´ë¡œë“œ
curl -fsSL https://raw.githubusercontent.com/your-org/claude-desk/main/install.sh | bash

# ì´ ìŠ¤í¬ë¦½íŠ¸ê°€ í•˜ëŠ” ì¼:
#   - docker-compose.yml ë‹¤ìš´ë¡œë“œ
#   - .env í…œí”Œë¦¿ ìƒì„±
#   - ADMIN_PASSWORD ìë™ ìƒì„±
#   - "ANTHROPIC_API_KEYë¥¼ .envì— ì…ë ¥í•˜ì„¸ìš”" ì•ˆë‚´

# 2. API í‚¤ ì„¤ì •
nano .env   # ANTHROPIC_API_KEY=sk-ant-... ì…ë ¥

# 3. ì‹¤í–‰
docker compose up -d

# 4. ì ‘ì†
# â†’ http://localhost:32354 (ë¡œì»¬)
# â†’ ë˜ëŠ” Cloudflare Tunnel ì„¤ì • ì‹œ https://desk.example.com
```

---

### Tier 2: ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ â€” Cloudflare Tunnel (ë¬´ë£Œ HTTPS)

**ì™œ Cloudflare Tunnelì¸ê°€:**
- ì™„ì „ ë¬´ë£Œ (ì‚¬ìš©ëŸ‰ ì œí•œ ì—†ìŒ)
- ì¸ë°”ìš´ë“œ í¬íŠ¸ ì—´ í•„ìš” ì—†ìŒ (ë°©í™”ë²½ ê±±ì • X)
- ìë™ HTTPS (ì¸ì¦ì„œ ê´€ë¦¬ ë¶ˆí•„ìš”)
- ê³ ì • URL (ì»¤ìŠ¤í…€ ë„ë©”ì¸ ì§€ì›)
- SSH í„°ë„ê³¼ ë‹¬ë¦¬ í•­ìƒ ì¼œì ¸ ìˆìŒ (systemd/Dockerë¡œ ë°ëª¬í™”)

**ì„¤ì • (í•œ ë²ˆë§Œ):**

```bash
# 1. Cloudflare ê³„ì •ì—ì„œ í„°ë„ ìƒì„± (Zero Trust ëŒ€ì‹œë³´ë“œ)
#    â†’ í„°ë„ í† í° ë°œê¸‰

# 2. .envì— í† í° ì¶”ê°€
CF_TUNNEL_TOKEN=eyJ...

# 3. docker compose up -d  (tunnel ì„œë¹„ìŠ¤ ìë™ ì‹œì‘)
```

**ê²°ê³¼:** `https://desk.yourteam.com` ìœ¼ë¡œ PC/ëª¨ë°”ì¼ ì–´ë””ì„œë“  ì ‘ì†.

**ëŒ€ì•ˆ ë¹„êµ:**

| ë°©ì‹ | ë¬´ë£Œ | ì»¤ìŠ¤í…€ ë„ë©”ì¸ | ì„¤ì • ë‚œì´ë„ | ì•ˆì •ì„± |
|------|------|-------------|-----------|--------|
| SSH í„°ë„ | âœ… | âŒ | ë†’ìŒ | ëŠê¹€ ì¦ìŒ |
| Cloudflare Tunnel | âœ… | âœ… | ì¤‘ê°„ | ë†’ìŒ |
| Tailscale Funnel | âœ… | âŒ (.ts.net ê³ ì •) | ë‚®ìŒ | ì¤‘ê°„ |
| ngrok | ë¶€ë¶„ ë¬´ë£Œ | ìœ ë£Œë§Œ | ë‚®ìŒ | ì¤‘ê°„ |
| VPS + Caddy + Let's Encrypt | âœ… | âœ… | ë†’ìŒ | ë†’ìŒ |

---

### Tier 3: ëª¨ë°”ì¼ ì§€ì› â€” PWA

**PWA (Progressive Web App)ë¡œ ëª¨ë°”ì¼ ì•±ì²˜ëŸ¼ ë™ì‘:**
- í™ˆ í™”ë©´ì— ì•„ì´ì½˜ ì¶”ê°€ â†’ ë¸Œë¼ìš°ì € í¬ë¡¬ ì—†ì´ ì‹¤í–‰
- ì „ì²´ í™”ë©´, ìŠ¤í”Œë˜ì‹œ ìŠ¤í¬ë¦°, ì•± ì „í™˜ê¸°ì— ë³„ë„ ì•±ìœ¼ë¡œ í‘œì‹œ
- ë³„ë„ ì•±ìŠ¤í† ì–´ ë°°í¬ ë¶ˆí•„ìš”

**êµ¬í˜„ (vite-plugin-pwa):**

```bash
npm install -D vite-plugin-pwa
```

```typescript
// vite.config.ts
import { VitePWA } from 'vite-plugin-pwa'

export default defineConfig({
  plugins: [
    VitePWA({
      registerType: 'autoUpdate',
      manifest: {
        name: 'Claude Desk',
        short_name: 'Desk',
        description: 'ë¦¬ì„œì¹˜ íŒ€ì„ ìœ„í•œ Claude Code ì›¹ í”Œë«í¼',
        theme_color: '#1a1a2e',
        background_color: '#1a1a2e',
        display: 'standalone',
        icons: [
          { src: '/icon-192.png', sizes: '192x192', type: 'image/png' },
          { src: '/icon-512.png', sizes: '512x512', type: 'image/png' }
        ]
      }
    })
  ]
})
```

**Phase 4ì— í†µí•©:** ëª¨ë°”ì¼ ë°˜ì‘í˜• + PWAë¥¼ í•¨ê»˜ ì§„í–‰.

---

### Tier 4: í´ë¼ìš°ë“œ ì›í´ë¦­ ë°°í¬ (ì„œë²„ ì—†ì´)

**ì„œë²„ë¥¼ ì§ì ‘ ê´€ë¦¬í•˜ê³  ì‹¶ì§€ ì•Šì€ íŒ€ìš©.**

| í”Œë«í¼ | WebSocket ì§€ì› | ì¥ì  | ë‹¨ì  |
|--------|---------------|------|------|
| **Fly.io** | ë„¤ì´í‹°ë¸Œ (ìµœì ) | ê¸€ë¡œë²Œ ì—£ì§€, WS íŠ¹í™” | ìˆ˜ë™ ìŠ¤ì¼€ì¼ë§ |
| **Railway** | ì™„ì „ ì§€ì› | ê°€ì¥ ì‰¬ìš´ ë°°í¬, GitHub ì—°ë™ | ë¹„ìš© ì˜ˆì¸¡ ì–´ë ¤ì›€ |
| **Render** | ì§€ì› (ì œì•½ ìˆìŒ) | ê´€ë¦¬í˜• DB | WS sticky session ì—†ìŒ, keepalive í•„ìˆ˜ |

**ì¶”ì²œ: Fly.io** (WebSocket ì•±ì— ìµœì í™”)

```bash
# fly.toml
[http_service]
  internal_port = 32354
  force_https = true
  auto_stop_machines = true
  auto_start_machines = true

[env]
  AUTH_ENABLED = "true"
```

**READMEì— ì›í´ë¦­ ë°°í¬ ë²„íŠ¼:**

```markdown
[![Deploy on Railway](https://railway.app/button.svg)](https://railway.app/template/...)
[![Deploy on Fly.io](https://fly.io/button.svg)](https://fly.io/launch/...)
```

---

### ì„¤ì¹˜ ì‹œë‚˜ë¦¬ì˜¤ë³„ ê°€ì´ë“œ

#### ì‹œë‚˜ë¦¬ì˜¤ A: "ë‚´ PCì—ì„œ í˜¼ì ì“¸ë˜" (ê°€ì¥ ë‹¨ìˆœ)

```bash
docker run -d -p 32354:32354 \
  -v ~/.claude:/home/app/.claude \
  -e AUTH_ENABLED=false \
  ghcr.io/your-org/claude-desk:latest
# â†’ http://localhost:32354
```

#### ì‹œë‚˜ë¦¬ì˜¤ B: "íŒ€ì´ ì›ê²©ìœ¼ë¡œ ì ‘ì†í•´ì•¼ í•´" (ì¶”ì²œ)

```bash
curl -fsSL .../install.sh | bash
# .env í¸ì§‘ (APIí‚¤ + Cloudflare í„°ë„ í† í°)
docker compose up -d
# â†’ https://desk.yourteam.com
```

#### ì‹œë‚˜ë¦¬ì˜¤ C: "ì„œë²„ ê´€ë¦¬ ì‹«ì–´" (í´ë¼ìš°ë“œ)

```
GitHub repo fork â†’ Fly.io ì—°ê²° â†’ í™˜ê²½ë³€ìˆ˜ ì„¤ì • â†’ ìë™ ë°°í¬
```

---

### ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] HTTPS í•„ìˆ˜ (Cloudflare Tunnel ë˜ëŠ” Caddy)
- [ ] JWT ì¸ì¦ ê¸°ë³¸ í™œì„±í™” (AUTH_ENABLED=true)
- [ ] ANTHROPIC_API_KEYëŠ” í™˜ê²½ë³€ìˆ˜ë¡œë§Œ (ì´ë¯¸ì§€ì— í¬í•¨ ê¸ˆì§€)
- [ ] ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ê²½ë¡œ ë°– íŒŒì¼ ì ‘ê·¼ ì°¨ë‹¨ (ê¸°ì¡´ ì„¤ê³„)
- [ ] Docker ì»¨í…Œì´ë„ˆ non-root ìœ ì €ë¡œ ì‹¤í–‰ (uid ë§¤í•‘ í¬í•¨)
- [ ] Rate limiting (ë¡œê·¸ì¸ ì‹œë„ ì œí•œ)
- [ ] ì—­í• ë³„ permissionMode ì ìš© (user ì—­í• ì€ bypass ê¸ˆì§€)
- [ ] ë™ì‹œ ì„¸ì…˜ ìˆ˜ ìƒí•œ ì„¤ì •
- [ ] ì„¸ì…˜ JSONL / DB ìë™ ì •ë¦¬ ì •ì±… (90ì¼ ê¸°ë³¸)
- [ ] ëª¨ë°”ì¼: PWAëŠ” HTTPSì—ì„œë§Œ ì„¤ì¹˜ ê°€ëŠ¥ â†’ Tunnel í•„ìˆ˜

---

### ê°œë°œ ë‹¨ê³„ì— ì¶”ê°€

ì´ ë°°í¬ ì‘ì—…ì€ **Phase 5**ë¡œ ì§„í–‰:

1. Dockerfile + docker-compose.yml ì‘ì„±
2. install.sh ìŠ¤í¬ë¦½íŠ¸ (ë‹¤ìš´ë¡œë“œ + .env í…œí”Œë¦¿ + ì•ˆë‚´)
3. Cloudflare Tunnel í†µí•© (docker-composeì— ì„ íƒì  ì„œë¹„ìŠ¤)
4. PWA ì„¤ì • (vite-plugin-pwa + manifest + ì•„ì´ì½˜)
5. Fly.io / Railway ë°°í¬ ì„¤ì • (fly.toml, railway.json)
6. READMEì— ì‹œë‚˜ë¦¬ì˜¤ë³„ ì„¤ì¹˜ ê°€ì´ë“œ ì‘ì„±

---

## ìƒˆ Azure VMì— ì¬ì„¤ì¹˜ ê°€ì´ë“œ (business-ai ë“±)

### ì‚¬ì „ ì¡°ê±´

| í•­ëª© | í•„ìš” ë²„ì „ | í™•ì¸ ëª…ë ¹ |
|------|----------|----------|
| **OS** | Ubuntu 22.04+ (ì¶”ì²œ) | `lsb_release -a` |
| **Node.js** | v20.20.0+ | `node --version` |
| **npm** | v10+ | `npm --version` |
| **Git** | 2.x | `git --version` |
| **build-essential** | (any) | `dpkg -l build-essential` |
| **Python 3** | 3.8+ (better-sqlite3 ë¹Œë“œìš©) | `python3 --version` |
| **Claude Code CLI** | latest | `claude --version` |
| **Azure CLI** | 2.x (ë¡œì»¬ì—ì„œ VM ê´€ë¦¬ ì‹œ) | `az --version` |

---

### Step 0: Azure VM ìƒì„± (business-aiê°€ ì•„ì§ ì—†ì„ ê²½ìš°)

```bash
# ë¡œì»¬ì—ì„œ ì‹¤í–‰ (Azure CLI ì—°ê²°ëœ ë¨¸ì‹ )
az group create --name rg-business-ai --location koreacentral

az vm create \
  --resource-group rg-business-ai \
  --name business-ai \
  --image Ubuntu2204 \
  --size Standard_D2s_v3 \
  --admin-username azureuser \
  --generate-ssh-keys \
  --public-ip-sku Standard

# NSGì— í¬íŠ¸ 32354 ì˜¤í”ˆ (SSH í„°ë„ ì‚¬ìš© ì‹œ ë¶ˆí•„ìš”)
az vm open-port \
  --resource-group rg-business-ai \
  --name business-ai \
  --port 32354 --priority 1010

# VM IP í™•ì¸
az vm show -d --resource-group rg-business-ai --name business-ai \
  --query publicIps -o tsv
```

---

### Step 1: ëŒ€ìƒ VM ê¸°ì´ˆ í™˜ê²½ êµ¬ì„±

```bash
# SSH ì ‘ì†
ssh azureuser@<BUSINESS-AI-IP>

# ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸ + ë¹Œë“œ ë„êµ¬
sudo apt update && sudo apt upgrade -y
sudo apt install -y build-essential python3 git curl

# Node.js 20 ì„¤ì¹˜ (nvm ë°©ì‹)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh | bash
source ~/.bashrc
nvm install 20
nvm use 20
nvm alias default 20

# í™•ì¸
node --version   # v20.x.x
npm --version    # 10.x.x
```

---

### Step 2: Claude Code CLI ì„¤ì¹˜

```bash
# npm ê¸€ë¡œë²Œ ì„¤ì¹˜
npm install -g @anthropic-ai/claude-code

# ë˜ëŠ” ì§ì ‘ ë°”ì´ë„ˆë¦¬ (ì´ë¯¸ ì„¤ì¹˜ëœ ê²½ìš° ê²½ë¡œ í™•ì¸)
which claude    # /home/azureuser/.local/bin/claude ë˜ëŠ” nvm ê²½ë¡œ

# Claude ì¸ì¦ (ìµœì´ˆ 1íšŒ â€” ë¸Œë¼ìš°ì € OAuth ë˜ëŠ” API í‚¤)
claude          # ì‹¤í–‰ í›„ ì¸ì¦ í”Œë¡œìš° ì§„í–‰
# ë˜ëŠ” API í‚¤ ë°©ì‹:
export ANTHROPIC_API_KEY=sk-ant-...
```

> **ì°¸ê³ :** `config.ts`ì˜ `claudeExecutable` ê²½ë¡œê°€ ì‹¤ì œ ì„¤ì¹˜ ê²½ë¡œì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸.
> ë‹¤ë¥´ë©´ í™˜ê²½ë³€ìˆ˜ `CLAUDE_PATH`ë¡œ ì˜¤ë²„ë¼ì´ë“œ ê°€ëŠ¥.

---

### Step 3: í”„ë¡œì íŠ¸ ì½”ë“œ ì „ì†¡

**ë°©ë²• A: Git (ì¶”ì²œ â€” remote ì„¤ì • í•„ìš”)**

```bash
# í˜„ì¬ ì„œë²„ (tunnelingcc)ì—ì„œ â€” GitHub ë“±ì— remote ì¶”ê°€
cd /home/azureuser/tunnelingcc
git remote add origin git@github.com:<org>/claude-desk.git
git add -A && git commit -m "snapshot for deployment"
git push -u origin main

# ëŒ€ìƒ VMì—ì„œ
cd ~
git clone git@github.com:<org>/claude-desk.git tunnelingcc
```

**ë°©ë²• B: scp / rsync (remote ì—†ì„ ë•Œ)**

```bash
# í˜„ì¬ ì„œë²„ì—ì„œ ëŒ€ìƒ VMìœ¼ë¡œ ì§ì ‘ ì „ì†¡
rsync -avz --exclude='node_modules' --exclude='dist' --exclude='data/*.db*' \
  /home/azureuser/tunnelingcc/ \
  azureuser@<BUSINESS-AI-IP>:~/tunnelingcc/

# ë˜ëŠ” ë¡œì»¬ì„ ê²½ìœ 
scp -r azureuser@4.230.33.35:~/tunnelingcc/ ./tunnelingcc-backup/
scp -r ./tunnelingcc-backup/ azureuser@<BUSINESS-AI-IP>:~/tunnelingcc/
```

**ë°©ë²• C: Azure CLIë¡œ VM ê°„ ì „ì†¡ (ê°™ì€ êµ¬ë…)**

```bash
# í˜„ì¬ VMì—ì„œ ëŒ€ìƒ VM IP í™•ì¸ í›„ ì§ì ‘ rsync
DEST_IP=$(az vm show -d -g rg-business-ai -n business-ai --query publicIps -o tsv)
rsync -avz --exclude='node_modules' --exclude='dist' --exclude='data/*.db*' \
  /home/azureuser/tunnelingcc/ azureuser@$DEST_IP:~/tunnelingcc/
```

---

### Step 4: ì˜ì¡´ì„± ì„¤ì¹˜ + ë¹Œë“œ

```bash
ssh azureuser@<BUSINESS-AI-IP>

cd ~/tunnelingcc/claude-desk

# ì˜ì¡´ì„± ì„¤ì¹˜ (better-sqlite3 ë„¤ì´í‹°ë¸Œ ì»´íŒŒì¼ í¬í•¨)
npm ci

# í”„ë¡œë•ì…˜ ë¹Œë“œ
npm run build

# ë¹Œë“œ ê²°ê³¼ í™•ì¸
ls dist/backend/index.js    # ë°±ì—”ë“œ
ls dist/frontend/index.html # í”„ë¡ íŠ¸ì—”ë“œ
```

> **better-sqlite3 ë¹Œë“œ ì‹¤íŒ¨ ì‹œ:**
> `sudo apt install -y build-essential python3` í™•ì¸ í›„ `npm rebuild better-sqlite3`

---

### Step 5: í™˜ê²½ ì„¤ì •

```bash
# start.sh ìˆ˜ì • â€” ê²½ë¡œë¥¼ ëŒ€ìƒ VMì— ë§ê²Œ
cd ~/tunnelingcc/claude-desk

cat > start.sh << 'STARTEOF'
#!/bin/bash
# Claude Desk ì„œë²„ ì‹œì‘ ìŠ¤í¬ë¦½íŠ¸
cd "$(dirname "$0")"

export NO_AUTH=true
export DEFAULT_CWD=/home/azureuser
export WORKSPACE_ROOT=/home/azureuser
# export CLAUDE_PATH=/home/azureuser/.nvm/versions/node/v20.x.x/bin/claude  # nvm ê²½ë¡œì¼ ê²½ìš°

echo "Starting Claude Desk..."
echo "ì ‘ì†: http://localhost:32354"
echo ""

npx tsx backend/index.ts
STARTEOF

chmod +x start.sh
```

**config.ts ê²½ë¡œ í™•ì¸ ì²´í¬ë¦¬ìŠ¤íŠ¸:**
- [ ] `claudeExecutable` â€” Claude CLI ì‹¤ì œ ê²½ë¡œ (`which claude`ë¡œ í™•ì¸)
- [ ] `defaultCwd` â€” í™˜ê²½ë³€ìˆ˜ ë˜ëŠ” ê¸°ë³¸ê°’
- [ ] `workspaceRoot` â€” í™˜ê²½ë³€ìˆ˜ ë˜ëŠ” ê¸°ë³¸ê°’
- [ ] `dbPath` â€” data/ ë””ë ‰í† ë¦¬ ì¡´ì¬ í™•ì¸ (`mkdir -p data`)

---

### Step 6: ì„œë¹„ìŠ¤ ë“±ë¡ (systemd â€” ì¬ë¶€íŒ… ì‹œ ìë™ ì‹œì‘)

```bash
sudo tee /etc/systemd/system/claude-desk.service << 'EOF'
[Unit]
Description=Claude Desk Web Platform
After=network.target

[Service]
Type=simple
User=azureuser
WorkingDirectory=/home/azureuser/tunnelingcc/claude-desk
ExecStart=/home/azureuser/.nvm/versions/node/v20.20.0/bin/node dist/backend/index.js
Restart=on-failure
RestartSec=5
Environment=NO_AUTH=true
Environment=DEFAULT_CWD=/home/azureuser
Environment=WORKSPACE_ROOT=/home/azureuser
# Environment=CLAUDE_PATH=/home/azureuser/.local/bin/claude
# Environment=ANTHROPIC_API_KEY=sk-ant-...

[Install]
WantedBy=multi-user.target
EOF

sudo systemctl daemon-reload
sudo systemctl enable claude-desk
sudo systemctl start claude-desk

# ìƒíƒœ í™•ì¸
sudo systemctl status claude-desk
journalctl -u claude-desk -f   # ë¡œê·¸ ì‹¤ì‹œê°„ í™•ì¸
```

> **ì£¼ì˜:** nvm ì‚¬ìš© ì‹œ `ExecStart`ì˜ node ê²½ë¡œë¥¼ ì ˆëŒ€ê²½ë¡œë¡œ ì§€ì •í•´ì•¼ í•¨.
> `which node` ë¡œ í™•ì¸ í›„ ì ìš©.

---

### Step 7: ì ‘ì† í™•ì¸

```bash
# ë¡œì»¬ì—ì„œ SSH í„°ë„
ssh -L 32354:localhost:32354 azureuser@<BUSINESS-AI-IP>

# ë¸Œë¼ìš°ì €ì—ì„œ
# http://localhost:32354
```

---

### Step 8: ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ (ì„ íƒ)

ê¸°ì¡´ ì„œë²„ì˜ ì„¸ì…˜/ë©”ì‹œì§€ ë°ì´í„°ë¥¼ ì´ì „í•˜ë ¤ë©´:

```bash
# í˜„ì¬ ì„œë²„ì—ì„œ DB íŒŒì¼ ë³µì‚¬
scp azureuser@4.230.33.35:~/tunnelingcc/claude-desk/data/claude-desk.db \
    azureuser@<BUSINESS-AI-IP>:~/tunnelingcc/claude-desk/data/

# Claude ë„¤ì´í‹°ë¸Œ ì„¸ì…˜ë„ ì´ì „í•˜ë ¤ë©´ (ì„ íƒ)
rsync -avz ~/.claude/projects/ azureuser@<BUSINESS-AI-IP>:~/.claude/projects/
```

---

### ì¬ì„¤ì¹˜ ì›ì»¤ë§¨ë“œ ìŠ¤í¬ë¦½íŠ¸ (í–¥í›„ ìë™í™”)

ì•„ë˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë§Œë“¤ì–´ë‘ë©´ ì¶”í›„ ì¬ì„¤ì¹˜ê°€ ê°„í¸í•´ì§:

```bash
#!/bin/bash
# install-claude-desk.sh â€” ìƒˆ VMì—ì„œ ì‹¤í–‰
set -e

echo "=== Claude Desk ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ==="

# 1. ì‹œìŠ¤í…œ ì˜ì¡´ì„±
sudo apt update && sudo apt install -y build-essential python3 git curl

# 2. Node.js 20
if ! command -v node &> /dev/null; then
  curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh | bash
  export NVM_DIR="$HOME/.nvm"
  [ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"
  nvm install 20
fi

# 3. Claude Code CLI
if ! command -v claude &> /dev/null; then
  npm install -g @anthropic-ai/claude-code
  echo "âš  Claude CLI ì¸ì¦ì„ ì™„ë£Œí•˜ì„¸ìš”: claude"
fi

# 4. í”„ë¡œì íŠ¸ ì„¤ì¹˜
cd ~/tunnelingcc/claude-desk
npm ci
npm run build
mkdir -p data

# 5. systemd ë“±ë¡
echo "=== systemd ì„œë¹„ìŠ¤ ë“±ë¡ ==="
# (Step 6ì˜ ë‚´ìš©ì„ ì—¬ê¸°ì— í¬í•¨)

echo "=== ì„¤ì¹˜ ì™„ë£Œ ==="
echo "ì‹œì‘: sudo systemctl start claude-desk"
echo "ì ‘ì†: http://localhost:32354"
```

---

### ì¬ì„¤ì¹˜ ì „ ì½”ë“œ ê°œì„  ê¶Œì¥ ì‚¬í•­

í˜„ì¬ ì½”ë“œì—ì„œ ì¬ì„¤ì¹˜ ìš©ì´ì„±ì„ ë†’ì´ë ¤ë©´ ë‹¤ìŒì„ ê¶Œì¥:

1. **Git remote ì„¤ì •** â€” ì½”ë“œ ë²„ì „ ê´€ë¦¬ ë° ì „ì†¡ìš© (í˜„ì¬ remote ì—†ìŒ)
2. **ê²½ë¡œ í•˜ë“œì½”ë”© ì œê±°** â€” `config.ts`ì˜ ê¸°ë³¸ê°’ë“¤ì´ `/home/azureuser`ë¥¼ ì°¸ì¡°í•¨. í™˜ê²½ë³€ìˆ˜ ìš°ì„ ìœ¼ë¡œ ì´ë¯¸ ì„¤ê³„ë˜ì–´ ìˆì–´ `.env` íŒŒì¼ë§Œ ì˜ ì„¸íŒ…í•˜ë©´ ë¨
3. **`.env.example` íŒŒì¼ ì¶”ê°€** â€” í•„ìš”í•œ í™˜ê²½ë³€ìˆ˜ ëª©ë¡ ë¬¸ì„œí™”
4. **Dockerfile ì‘ì„±** (Phase 6ì— ê³„íšë¨) â€” Docker ë°©ì‹ì´ë©´ ìœ„ Step 1~5ê°€ ëª¨ë‘ ìƒëµ ê°€ëŠ¥
